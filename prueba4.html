<!DOCTYPE html>
<html>
<head>
  <title>MQTT Web Client</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js"></script>
</head>
<body>
  <h2>Mensajes recibidos en juan23/chat:</h2>
  <div id="messages"></div>

  <script>
    // Configuraci√≥n del broker y topic
    const brokerHost = "mqtt.flespi.io";
    const brokerPort = 443;
    const brokerPath = "/mqtt";
    const topic = "juan23/chat";

    // ‚ö†Ô∏è Reemplaza con tu token de acceso de Flespi (desde flespi.io)
    const flespiToken = "FlespiToken feRmBrbgP4G0GJU9sbhFh8OKRiQuIf4ZnIi8N3ORKh2lEScKK50A6Cx4hISyrEEV";

    // Crear cliente con ID aleatorio
    const clientID = "webclient_" + Math.floor(Math.random() * 10000);
    const client = new Paho.MQTT.Client(brokerHost, brokerPort, brokerPath, clientID);

    // Conexi√≥n al broker
    client.connect({
      useSSL: true,
      userName: flespiToken,
      onSuccess: onConnect,
      onFailure: (err) => {
        console.error("‚ùå Error al conectar:", err.errorMessage);
      }
    });

    // Cuando conecta correctamente
    function onConnect() {
      console.log("‚úÖ Conectado al broker Flespi");
      client.subscribe(topic);
    }

    // Cuando se recibe un mensaje
    client.onMessageArrived = function(message) {
      console.log("üì© Mensaje recibido:", message.payloadString);
      const msgDiv = document.getElementById("messages");
      msgDiv.innerHTML += "<p>" + message.payloadString + "</p>";
    };

    // Si se pierde la conexi√≥n
    client.onConnectionLost = function(responseObject) {
      if (responseObject.errorCode !== 0) {
        console.warn("‚ö†Ô∏è Conexi√≥n perdida:", responseObject.errorMessage);
      }
    };
  </script>
</body>
</html>
