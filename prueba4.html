<!DOCTYPE html>
<html>
<head>
  <title>MQTT Web Client</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js"></script>
</head>
<body>
  <h2>Mensajes recibidos en juan23/chat:</h2>
  <div id="messages"></div>

  <script>
    // Configuración del cliente
    const broker = "wss://mqtt.flespi.io:443";
    const topic = "juan23/chat";

    // Reemplaza con tu token real de Flespi
    const flespiToken = "FlespiToken feRmBrbgP4G0GJU9sbhFh8OKRiQuIf4ZnIi8N3ORKh2lEScKK50A6Cx4hISyrEEV";

    const clientID = "webclient_" + parseInt(Math.random() * 10000);
    const client = new Paho.MQTT.Client(broker, clientID);

    // Función de conexión
    client.connect({
      useSSL: true,
      onSuccess: onConnect,
      userName: flespiToken,
      onFailure: (err) => {
        console.error("Error al conectar:", err);
      }
    });

    // Función cuando conecta correctamente
    function onConnect() {
      console.log("Conectado al broker");
      client.subscribe(topic);
    }

    // Función cuando llega un mensaje
    client.onMessageArrived = function(message) {
      console.log("Mensaje recibido:", message.payloadString);
      const msgDiv = document.getElementById("messages");
      msgDiv.innerHTML += "<p>" + message.payloadString + "</p>";
    };

    // Función si se pierde la conexión
    client.onConnectionLost = function(responseObject) {
      if (responseObject.errorCode !== 0) {
        console.log("Conexión perdida:", responseObject.errorMessage);
      }
    };
  </script>
</body>
</html>
