<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>MQTT con Flespi - Chat Juan23</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js"></script>
</head>
<body>
  <h2>Chat MQTT - Topic: juan23/chat</h2>

  <input type="text" id="mensaje" placeholder="EscribÃ­ tu mensaje">
  <button onclick="enviarMensaje()">Enviar</button>

  <div id="mensajes" style="margin-top:20px;"></div>

  <script>
    // Crear cliente MQTT
    const clientId = "web_" + Math.random().toString(16).substr(2, 8);
    const client = new Paho.MQTT.Client("mqtt.flespi.io", 443, clientId);

    // ConexiÃ³n
    client.connect({
      useSSL: true,
      userName: "FlespiToken",
      password: "feRmBrbgP4G0GJU9sbhFh8OKRiQuIf4ZnIi8N3ORKh2lEScKK50A6Cx4hISyrEEV", // <-- ReemplazÃ¡ con tu token de Flespi
      onSuccess: () => {
        console.log("âœ… Conectado a Flespi");
        client.subscribe("juan23/chat");
      },
      onFailure: (err) => {
        console.error("âŒ Error de conexiÃ³n:", err.errorMessage);
      }
    });

    // Al llegar un mensaje
    client.onMessageArrived = (mensaje) => {
      const div = document.getElementById("mensajes");
      div.innerHTML += `<p>ðŸ“¥ <strong>Recibido:</strong> ${mensaje.payloadString}</p>`;
    };

    // Enviar mensaje
    function enviarMensaje() {
      const input = document.getElementById("mensaje");
      const texto = input.value.trim();
      if (texto) {
        const msg = new Paho.MQTT.Message(texto);
        msg.destinationName = "juan23/chat";
        client.send(msg);
        input.value = "";
      }
    }
  </script>
</body>
</html>
