<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>MQTT Chat Viewer</title>
  <script src="https://unpkg.com/paho-mqtt/mqttws31.min.js"></script>
</head>
<body>
  <h2>Mensajes del topic: juan23/chat</h2>
  <div id="mensajes" style="border:1px solid #ccc; padding:10px; width:300px; height:200px; overflow-y:scroll;"></div>

  <script>
    // Crear cliente MQTT (WebSocket, puerto 443)
    const client = new Paho.MQTT.Client("mqtt.flespi.io", 443, "clientId-" + Math.random());

    // Opciones de conexión
    const options = {
      useSSL: true,
      userName: "FlespiToken",           // Literal
      password: "feRmBrbgP4G0GJU9sbhFh8OKRiQuIf4ZnIi8N3ORKh2lEScKK50A6Cx4hISyrEEV",         // ⚠️ Reemplaza con tu token real
      onSuccess: onConnect,
      onFailure: (err) => {
        console.error("Error de conexión:", err.errorMessage);
      }
    };

    // Conectar
    client.connect(options);

    // Conexión exitosa
    function onConnect() {
      console.log("Conectado a flespi MQTT");
      client.subscribe("juan23/chat");
    }

    // Mensaje recibido
    client.onMessageArrived = function(message) {
      const mensajesDiv = document.getElementById("mensajes");
      const nuevoMensaje = document.createElement("div");
      nuevoMensaje.textContent = message.payloadString;
      mensajesDiv.appendChild(nuevoMensaje);
      mensajesDiv.scrollTop = mensajesDiv.scrollHeight;
    };

    // Manejo de desconexión (opcional)
    client.onConnectionLost = function(responseObject) {
      if (responseObject.errorCode !== 0) {
        console.log("Conexión perdida:", responseObject.errorMessage);
      }
    };
  </script>
</body>
</html>
