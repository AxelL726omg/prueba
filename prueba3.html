<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Conexi√≥n MQTT a Flespi</title>
  <script src="https://unpkg.com/paho-mqtt/mqttws31.min.js"></script>
</head>
<body>
  <h2>MQTT con Flespi</h2>
  
  <input type="text" id="mensaje" placeholder="Escrib√≠ un mensaje" />
  <button onclick="enviarMensaje()">Enviar</button>

  <div id="mensajes"></div>

  <script>
    // üîê Reemplaz√° con tu token real (copi√° y peg√° desde Flespi)
    const TOKEN = "FlespiToken TU_TOKEN_ACA";

    // üßµ Tema al que te vas a conectar (puede ser cualquiera)
    const TOPIC = "juan23/chat";

    // üõ∞Ô∏è Crear cliente MQTT WebSocket
    const client = new Paho.MQTT.Client("mqtt.flespi.io", 443, "cliente-web-" + Math.random());

    // üì° Mensaje recibido
    client.onMessageArrived = (message) => {
      const div = document.getElementById("mensajes");
      div.innerHTML += `<p><strong>Recibido:</strong> ${message.payloadString}</p>`;
    };

    // ‚ùå Conexi√≥n perdida
    client.onConnectionLost = (e) => {
      console.error("Conexi√≥n perdida:", e.errorMessage);
    };

    // ‚úÖ Conexi√≥n exitosa
    client.connect({
      useSSL: true,
      userName: TOKEN,
      password: "",
      onSuccess: () => {
        console.log("‚úÖ Conectado a Flespi");
        client.subscribe(TOPIC);
      },
      onFailure: (e) => {
        console.error("‚ùå Error al conectar:", e.errorMessage);
      }
    });

    // ‚úâÔ∏è Enviar mensaje
    function enviarMensaje() {
      const texto = document.getElementById("mensaje").value;
      if (texto) {
        const message = new Paho.MQTT.Message(texto);
        message.destinationName = TOPIC;
        client.send(message);
      }
    }
  </script>
</body>
</html>
