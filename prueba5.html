<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Chat Web MQTT</title>
  <script src="https://unpkg.com/paho-mqtt/mqttws31.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button { padding: 10px; font-size: 16px; }
    #labelRecibido { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>

  <h2>Comunicaci√≥n Web MQTT</h2>
  
  <input type="text" id="texto" placeholder="Escrib√≠ algo" />
  <button onclick="enviar()">Enviar al otro</button>

  <div id="labelRecibido">Esperando mensaje...</div>

  <script>
    const TOKEN = "FlespiToken TU_TOKEN_ACA"; // üîê Peg√° tu token
    const TOPIC = "juan23/chat"; // üßµ Us√° el mismo en las dos webs

    const client = new Paho.MQTT.Client("mqtt.flespi.io", 443, "cliente-" + Math.random());

    client.onMessageArrived = (msg) => {
      document.getElementById("labelRecibido").textContent = "Recibido: " + msg.payloadString;
    };

    client.onConnectionLost = (e) => {
      console.log("Conexi√≥n perdida:", e.errorMessage);
    };

    client.connect({
      useSSL: true,
      userName: TOKEN,
      password: "",
      onSuccess: () => {
        console.log("‚úÖ Conectado");
        client.subscribe(TOPIC);
      },
      onFailure: (e) => {
        console.log("‚ùå Error al conectar:", e.errorMessage);
      }
    });

    function enviar() {
      const texto = document.getElementById("texto").value;
      if (texto) {
        const msg = new Paho.MQTT.Message(texto);
        msg.destinationName = TOPIC;
        client.send(msg);
      }
    }
  </script>
</body>
</html>
